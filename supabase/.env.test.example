# ──────────────────────────────────────────────────────────────────────────────
# Variáveis de ambiente para os testes de integração das Edge Functions.
# Copie este arquivo para supabase/.env.test e preencha os valores reais.
# O arquivo .env.test NÃO deve ser commitado (já está no .gitignore da raiz).
# ──────────────────────────────────────────────────────────────────────────────

# URL e chaves do projeto Supabase
SUPABASE_URL=https://cgdxdawwiarzwfxwjqvx.supabase.co
SUPABASE_ANON_KEY=<sua_anon_key>
SUPABASE_SERVICE_ROLE_KEY=<sua_service_role_key>

# JWT de um usuário com role "admin" (para testar funções protegidas)
# Obtenha via: supabase auth sign-in → copie o access_token da resposta
TEST_ADMIN_JWT=<jwt_de_usuario_admin>

# JWT de um usuário SEM role admin (para testar que 403 é retornado)
# Deixe em branco para pular os testes de autorização de usuário comum
TEST_USER_JWT=

# Segredo do webhook OneCode (valor configurado no painel Supabase como secret)
ONECODE_WEBHOOK_SECRET=<seu_webhook_secret>

# Slug do tenant para smoke tests do sync-acessorias ("contmax" ou "pg")
TEST_TENANT_SLUG=contmax

# UUID do tenant para smoke tests de run-integration
TEST_TENANT_ID=<uuid_da_organizacao_contmax>

# ──────────────────────────────────────────────────────────────────────────────
# Como usar
# ──────────────────────────────────────────────────────────────────────────────
#
# 1. Carregue as variáveis no shell:
#      set -a && source supabase/.env.test && set +a
#
# 2. Execute os testes unitários (sem rede, sem credenciais):
#      cd supabase && deno task test:unit
#
# 3. Execute os testes de integração (requer SUPABASE_URL e SUPABASE_ANON_KEY):
#      cd supabase && deno task test:integration
#
# 4. Execute todos os testes:
#      cd supabase && deno task test
#
# Ou a partir da raiz do projeto:
#      npm run test:functions:unit
#      npm run test:functions:integration
#      npm run test:functions
